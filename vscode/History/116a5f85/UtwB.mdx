export const metadata = {
  title: 'Deployment and Backup Guide for PostgreSQL Database on Hostinger VPS',
  description: 'Step-by-step guide to install, secure, and automate backups for PostgreSQL on a Hostinger VPS. Includes cron jobs and optional AWS S3 sync.',
  keywords: [
    'PostgreSQL VPS deployment',
    'Hostinger PostgreSQL setup',
    'Postgres backup script',
    'PostgreSQL S3 backup',
    'Ubuntu PostgreSQL install',
    'Postgres production config',
    'Secure PostgreSQL VPS',
    'Automated PostgreSQL backup',
    'Postgres cron backup',
    'PostgreSQL on Hostinger',
  ],
  openGraph: {
    title: 'Deployment and Backup Guide for PostgreSQL Database on Hostinger VPS',
    description: 'A complete guide to deploying and backing up PostgreSQL on Hostinger VPS with automation and optional S3 support.',
    url: '[https://yourdomain.com/blogs/postgresql-deploy-and-backup-in-vps](https://yourdomain.com/blogs/postgresql-deploy-and-backup-in-vps)',
    siteName: 'Tariqul Dev Blog',
    locale: 'en_US',
    type: 'article',
  },
};

# Deployment and Backup Guide for PostgreSQL on Hostinger VPS

> A secure and production-ready setup of PostgreSQL on VPS with optional S3-based offsite backup.

## Prerequisites

- Hostinger VPS (Ubuntu 22.04 or higher)
- A domain (optional)
- PostgreSQL installed
- Optional: AWS S3 and AWS CLI configured

## Install PostgreSQL

```bash
sudo apt update && sudo apt upgrade -y
sudo apt install postgresql postgresql-contrib -y
```

## Secure PostgreSQL

### Change default password for postgres user

```bash
sudo -u postgres psql
\password postgres
```

Create a dedicated DB user:

```sql
CREATE USER dbuser WITH PASSWORD 'securepassword';
CREATE DATABASE mydatabase OWNER dbuser;
```

Exit:

```sql
\q
```

## Restrict External Access

Edit `postgresql.conf`:

```bash
sudo nano /etc/postgresql/14/main/postgresql.conf
```

Set:

```conf
listen_addresses = 'localhost'
```

Edit `pg_hba.conf`:

```bash
sudo nano /etc/postgresql/14/main/pg_hba.conf
```

Ensure:

```
local   all             all                                     peer
host    all             all             127.0.0.1/32            md5
```

Restart service:

```bash
sudo systemctl restart postgresql
```

## Configure UFW Firewall

```bash
sudo ufw enable
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw deny 5432
```

## PostgreSQL Backup Script

### Create Backup Directory

```bash
mkdir -p ~/backups/postgres
```

### Local Backup Script

`~/backups/postgres_backup_mydatabase.sh`

```bash
#!/bin/bash
BACKUP_DIR=~/backups/postgres
DB_NAME=mydatabase
TIMESTAMP=$(date +%F-%H-%M-%S)
BACKUP_NAME="backup-$DB_NAME-$TIMESTAMP.sql.gz"

pg_dump -U dbuser $DB_NAME | gzip > $BACKUP_DIR/$BACKUP_NAME

ls -t $BACKUP_DIR/backup-$DB_NAME-*.sql.gz | tail -n +6 | xargs -I {} rm {}
```

Make it executable:

```bash
chmod +x ~/backups/postgres_backup_mydatabase.sh
```

### Optional: Upload to S3

```bash
aws s3 cp $BACKUP_DIR/$BACKUP_NAME s3://your-postgres-backup/$BACKUP_NAME
```

## Automate with Cron

```bash
crontab -e
0 * * * * ~/backups/postgres_backup_mydatabase.sh
```

## Validate PostgreSQL Status

```bash
sudo systemctl status postgresql
```

## Remote Access (Optional)

Only if you _must_ allow remote connections:

```conf
# postgresql.conf
listen_addresses = '*'

# pg_hba.conf
host    all             all             0.0.0.0/0            md5
```

```bash
sudo systemctl restart postgresql
```

## Test Connection

```bash
psql -h 127.0.0.1 -U dbuser -d mydatabase
```

## Success!

You now have a production-ready PostgreSQL server on Hostinger VPS with automated backups (and optional AWS S3 sync).
